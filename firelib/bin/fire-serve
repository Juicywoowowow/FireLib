#!/usr/bin/env python3
"""
fire-serve - Quick web server
Automatically detects and uses available server (Python, Node, etc.)
"""

import sys
import os
import argparse
import subprocess
import shutil

def find_server():
    """Find available web server"""
    # Check for http.server (Python 3)
    if sys.version_info[0] >= 3:
        return 'python3', ['-m', 'http.server']
    
    # Check for SimpleHTTPServer (Python 2)
    if sys.version_info[0] == 2:
        return 'python2', ['-m', 'SimpleHTTPServer']
    
    # Check for Node.js http-server
    if shutil.which('http-server'):
        return 'http-server', []
    
    # Check for PHP
    if shutil.which('php'):
        return 'php', ['-S']
    
    return None, None

def main():
    parser = argparse.ArgumentParser(description='Quick web server')
    parser.add_argument('-p', '--port', type=int, default=8000, help='Port to serve on')
    parser.add_argument('-d', '--directory', default='.', help='Directory to serve')
    args = parser.parse_args()
    
    server, server_args = find_server()
    
    if not server:
        print("[!] No web server found. Install with: pkg install python")
        sys.exit(1)
    
    print(f"[*] Starting server on port {args.port}")
    print(f"[*] Serving: {os.path.abspath(args.directory)}")
    print(f"[*] Using: {server}")
    print(f"[*] Access at: http://localhost:{args.port}")
    print("[*] Press Ctrl+C to stop")
    
    os.chdir(args.directory)
    
    if server.startswith('python'):
        cmd = [server] + server_args + [str(args.port)]
    elif server == 'php':
        cmd = [server] + server_args + [f'localhost:{args.port}']
    else:
        cmd = [server, '-p', str(args.port)]
    
    try:
        subprocess.run(cmd)
    except KeyboardInterrupt:
        print("\n[*] Server stopped")

if __name__ == '__main__':
    main()
