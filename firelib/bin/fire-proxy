#!/usr/bin/env python3
"""
fire-proxy - Simple HTTP proxy server
"""

import sys
import argparse
from http.server import HTTPServer, BaseHTTPRequestHandler
import urllib.request

class ProxyHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        try:
            # Forward the request
            req = urllib.request.Request(self.path)
            for header, value in self.headers.items():
                if header.lower() not in ['host', 'connection']:
                    req.add_header(header, value)
            
            response = urllib.request.urlopen(req, timeout=10)
            
            # Send response
            self.send_response(response.status)
            for header, value in response.headers.items():
                if header.lower() not in ['transfer-encoding', 'connection']:
                    self.send_header(header, value)
            self.end_headers()
            
            self.wfile.write(response.read())
            
        except Exception as e:
            self.send_error(500, f"Proxy Error: {str(e)}")
    
    def log_message(self, format, *args):
        print(f"[*] {self.address_string()} - {format % args}")

def main():
    parser = argparse.ArgumentParser(description='Simple HTTP proxy server')
    parser.add_argument('-p', '--port', type=int, default=8888, help='Proxy port')
    parser.add_argument('-H', '--host', default='127.0.0.1', help='Bind host')
    args = parser.parse_args()
    
    print("=" * 50)
    print("Firelib Proxy Server")
    print("=" * 50)
    print(f"[*] Listening on {args.host}:{args.port}")
    print("[*] Press Ctrl+C to stop")
    print("=" * 50)
    
    server = HTTPServer((args.host, args.port), ProxyHandler)
    
    try:
        server.serve_forever()
    except KeyboardInterrupt:
        print("\n[*] Proxy stopped")

if __name__ == '__main__':
    main()
