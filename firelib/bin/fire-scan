#!/usr/bin/env python3
"""
fire-scan - Network scanner for pentesting
"""

import sys
import socket
import argparse
from concurrent.futures import ThreadPoolExecutor, as_completed

def scan_port(host, port, timeout=1):
    """Scan a single port"""
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(timeout)
        result = sock.connect_ex((host, port))
        sock.close()
        return port, result == 0
    except:
        return port, False

def get_service_name(port):
    """Get common service name for port"""
    services = {
        21: 'FTP', 22: 'SSH', 23: 'Telnet', 25: 'SMTP',
        53: 'DNS', 80: 'HTTP', 110: 'POP3', 143: 'IMAP',
        443: 'HTTPS', 445: 'SMB', 3306: 'MySQL', 3389: 'RDP',
        5432: 'PostgreSQL', 5900: 'VNC', 8080: 'HTTP-Alt',
        8443: 'HTTPS-Alt', 27017: 'MongoDB'
    }
    return services.get(port, 'Unknown')

def main():
    parser = argparse.ArgumentParser(description='Network port scanner')
    parser.add_argument('host', help='Target host or IP')
    parser.add_argument('-p', '--ports', default='1-1024', help='Port range (e.g., 1-1024 or 80,443,8080)')
    parser.add_argument('-t', '--threads', type=int, default=50, help='Number of threads')
    parser.add_argument('--timeout', type=float, default=1.0, help='Connection timeout')
    args = parser.parse_args()
    
    # Parse port range
    ports = []
    if '-' in args.ports:
        start, end = map(int, args.ports.split('-'))
        ports = range(start, end + 1)
    else:
        ports = [int(p) for p in args.ports.split(',')]
    
    print("=" * 50)
    print("Firelib Port Scanner")
    print("=" * 50)
    print(f"[*] Target: {args.host}")
    print(f"[*] Ports: {len(ports)}")
    print(f"[*] Scanning...")
    print("=" * 50)
    
    open_ports = []
    
    with ThreadPoolExecutor(max_workers=args.threads) as executor:
        futures = {executor.submit(scan_port, args.host, port, args.timeout): port for port in ports}
        
        for future in as_completed(futures):
            port, is_open = future.result()
            if is_open:
                service = get_service_name(port)
                print(f"[+] Port {port:5d} OPEN  - {service}")
                open_ports.append(port)
    
    print("=" * 50)
    print(f"[*] Scan complete: {len(open_ports)} open ports found")

if __name__ == '__main__':
    main()
